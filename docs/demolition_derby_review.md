# Demolition Derby Gamemode – Quick Review

## Identifizierte Issues

- **`g_derbyRamDamage` wirkte bislang nicht.** Die Ram-Logik nutzte ausschließlich den Geschwindigkeitsfaktor (`g_derbyRamDamageScale`) und die Maximalbegrenzung (`g_derbyRamDamageMax`). Der eigentliche Basiswert blieb wirkungslos und lag mit 100 zudem über dem Maximalwert. Inzwischen fließt der Basiswert additiv ein und die Standardwerte sind abgestimmt.【F:engine/code/game/g_weapon.c†L210-L247】【F:engine/code/game/g_main.c†L291-L293】
- **Scoreboard-Status sprach von "frags".** Im modernen Scoreboard lautete der Platzierungs-String für alle Nicht-Renn-Modi „place with %d frags“, auch im Demolition Derby, obwohl der Score dort aus Kollisionen stammt. Der Status meldet jetzt "wrecks" für GT_DERBY.【F:engine/code/cgame/cg_scoreboard.c†L2174-L2187】
- **Schadensspalte war missverständlich.** Die Spalte mit dem Header "DMG" zeigte im Scoreboard tatsächlich den erlittenen Schaden (`damageTaken`) an. Gerade im Derby erwartet man dort eher den verursachten Schaden oder eine explizite Kennzeichnung. Der Modus besitzt nun getrennte Spalten für verursachten und erlittenen Schaden sowie eine korrekte Todesanzeige für andere Modi.【F:engine/code/cgame/cg_scoreboard.c†L289-L324】【F:engine/code/cgame/cg_scoreboard.c†L2016-L2040】
- **Countdown meldete "Race ends" nach jeder Derby-Kollision.** Das Client-HUD startete den Renn-Abspann, sobald der Server einen `raceFinishTime`-Event versandte – auch wenn lediglich ein Fahrer eliminiert wurde. Der Countdown wird jetzt nur noch in echten Renn-Modi gesetzt.【F:engine/code/cgame/cg_rally_racetools.c†L58-L82】

## Konkrete Verbesserungsvorschläge

1. **Ram-Schaden neu balancieren:** `g_derbyRamDamage` als Mindestschaden oder additive Basis berücksichtigen und die Standardwerte der Ram-Cvars aufeinander abstimmen (z. B. Maximalwert ≥ Basiswert). So lassen sich Fahrzeug-Klassen oder Derbys mit mehr "Wucht" einfacher konfigurieren.【F:engine/code/game/g_weapon.c†L210-L247】【F:engine/code/game/g_main.c†L291-L293】
2. **Scoreboard-Text für Derby anpassen:** Für GT_DERBY einen alternativen Status-String verwenden („…mit %d Punkten/Wrecks“) und optional eine zweite Schadensspalte für ausgeteilten Schaden ergänzen. Dadurch spiegelt das HUD besser die tatsächliche Leistung wider.【F:engine/code/cgame/cg_scoreboard.c†L2174-L2187】【F:engine/code/cgame/cg_scoreboard.c†L2016-L2040】
3. **Visualisierung der Trefferwirkung verbessern:** Spieler-Feedback könnte durch Effekte (z. B. zunehmende Rauchentwicklung bei geringer HP oder Bildschirmrütteln bei heftigen Treffern) erweitert werden. Die Strukturen für Schadensverarbeitung und Events sind bereits vorhanden (`Weapon_DerbyRam`, `G_RadiusDamage`) und ließen sich dafür nutzen.【F:engine/code/game/g_weapon.c†L210-L247】【F:engine/code/game/g_combat.c†L1351-L1436】

## Umsetzungsstatus (Oktober 2025)

- [x] Ram-Schaden berücksichtigt jetzt den Basiswert `g_derbyRamDamage`; Standardwerte wurden auf einen sinnvollen Wertebereich abgestimmt.【F:engine/code/game/g_weapon.c†L210-L247】【F:engine/code/game/g_main.c†L291-L293】
- [x] Scoreboard zeigt im Derby "wrecks" an und trennt verursachten von erlittenem Schaden in eigenen Spalten.【F:engine/code/cgame/cg_scoreboard.c†L2174-L2187】【F:engine/code/cgame/cg_scoreboard.c†L289-L324】【F:engine/code/cgame/cg_scoreboard.c†L2016-L2040】
- [x] Der "Race ends"-Countdown bleibt im Derby aus und erscheint nur noch bei echten Renn-Enden.【F:engine/code/cgame/cg_rally_racetools.c†L58-L82】
- [x] Ladder-Uploads behalten das bestehende Schema bei: Der Server packt weiterhin `damageDealt`/`damageTaken` aus den Derby-Scoreboards in den Payload, der HTTP-Reporter serialisiert sie unverändert. Die HUD-Kürzel "DD"/"DT" sind daher rein kosmetisch.【F:engine/code/game/g_main.c†L1768-L1806】【F:engine/code/server/sv_ladder.c†L468-L510】
- [x] Das Derby-HUD blinkt bei schweren Treffern auf: Verliert ein Spieler auf einen Schlag mehr als 25 Lebenspunkte, setzt der Client einen kurzen Orangeton über das gesamte HUD, um den Einschlag hervorzuheben.【F:engine/code/cgame/cg_playerstate.c†L175-L205】【F:engine/code/cgame/cg_rally_hud2.c†L567-L607】
- [ ] Verbesserte Treffer-Visualisierung steht weiterhin aus: Effekte für starke Einschläge (z. B. Kamera-Rütteln, verstärktes Schadens-HUD, progressive Rauch-/Funken-Emitter) sind bislang nur Ideen und müssten noch konzipiert, abgestimmt und mit passenden Assets versehen werden. Eine dedizierte Anzeige für strukturelle Schäden könnte als eigenes Derby-HUD-Panel funktionieren, das die Fahrzeugkarosserie in grobe Stufen (grün/gelb/rot) oder segmentierte Streben auf Basis des aktuellen `STAT_HEALTH`-Anteils visualisiert, damit Spieler den Zustand ihres Wagens unabhängig von kurzfristigen Trefferblitzen einschätzen können. Denkbar wäre eine schematische Draufsicht auf den Wagen mit vier bis sechs Segmenten (Front, Seiten, Heck, Dach), die sich abhängig vom prozentualen Restleben einfärben und bei kritischen Schwellen (≤50 %, ≤25 %) zusätzliche Warn-Symbole einblenden. Für eine solche Anzeige wären mindestens nötig: (1) neue HUD-Grafiken bzw. Shader für die Segment-Layouts in den Zuständen „gesund“, „angeschlagen“ und „kritisch“, (2) optionale Overlay-Animationen (z. B. pulsierende Konturen) zur Betonung schwerer Schäden sowie (3) passende Sound- oder Partikel-Trigger, falls die visuelle Anzeige von Audio-/Partikeleffekten flankiert werden soll. Zusätzlich müsste das Menü- bzw. HUD-Layout eine Container-Fläche bereitstellen, in der diese Assets in `cg_rally_hud2` platziert und über `STAT_HEALTH`-basierte Schwellen gesteuert werden.

Diese Punkte liefern einen schnellen Einstieg, um den Modus sowohl technisch zu härten als auch spielerisch verständlicher zu machen.
